from telegram import ReplyKeyboardMarkup, Update
from telegram.ext import Updater, CommandHandler, MessageHandler, Filters, CallbackContext
from flask import Flask
import threading

TOKEN = '7600734297:AAEUfHpSLgxMyRj8vxC8rto3upyB9hVC2ys'  # –í—Å—Ç–∞–≤—å —Ç–æ–∫–µ–Ω –æ—Ç BotFather

# –í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã
questions = [
    {"q": "–†–µ–±–µ–Ω–æ–∫ –æ—Ç–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —É–±–∏—Ä–∞—Ç—å –∏–≥—Ä—É—à–∫–∏. –í–∞—à–∏ –¥–µ–π—Å—Ç–≤–∏—è?", "a": [
        "1. –£–±–µ—Ä–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏–≥—Ä—É—à–∫–∏. –ü–æ–≤—Ç–æ—Ä—è—é, –ø–æ–∫–∞ –Ω–µ –ø—Å–∏—Ö–∞–Ω—É –∏ –Ω–µ –∫—Ä–∏–∫–Ω—É",
        "2. –î–∞–≤–∞–π –ø–æ–∏–≥—Ä–∞–µ–º –≤ –∏–≥—Ä—É, –∫—Ç–æ –±—ã—Å—Ç—Ä–µ–µ —Å–æ–±–µ—Ä—ë—Ç –∏–≥—Ä—É—à–∫–∏ –≤ —Ç–æ—Ç —è—â–∏–∫.",
        "3. –£–±–µ—Ä–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏–≥—Ä—É—à–∫–∏. –ü–æ–≤—Ç–æ—Ä—é 3 —Ä–∞–∑–∞, –Ω–∞ 4 –ø–æ–π–¥—É —Å–∞–º–∞ —É–±–µ—Ä—É",
        "4. –ë—ã—Å—Ç—Ä–æ —Å–æ–±–µ—Ä–∏ —Å–≤–æ–∏ –∏–≥—Ä—É—à–∫–∏. –ß–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –±—É–¥—É—Ç —É–±—Ä–∞–Ω—ã, –≤—Å–µ –≤—ã–∫–∏–Ω—É"
    ], "styles": [1, 2, 3, 4]},

    {"q": "–ö–∞–∫–æ–µ –∏–∑ —Å—É–∂–¥–µ–Ω–∏–π –æ –≤–æ—Å–ø–∏—Ç–∞–Ω–∏–∏ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ –Ω–∞–∏–±–æ–ª–µ–µ —É–¥–∞—á–Ω—ã–º?", "a": [
        "1. –ï—Å–ª–∏ –≤–∞–º –±–æ–ª—å—à–µ –Ω–µ—á–µ–≥–æ —Å–∫–∞–∑–∞—Ç—å —Ä–µ–±–µ–Ω–∫—É, —Å–∫–∞–∂–∏—Ç–µ –µ–º—É, —á—Ç–æ–±—ã –æ–Ω –ø–æ—à–µ–ª —É–º—ã—Ç—å—Å—è",
        "2. –¶–µ–ª—å –≤–æ—Å–ø–∏—Ç–∞–Ω–∏—è ‚Äì –Ω–∞—É—á–∏—Ç—å –¥–µ—Ç–µ–π –æ–±—Ö–æ–¥–∏—Ç—å—Å—è –±–µ–∑ –Ω–∞—Å",
        "3. –î–µ—Ç—è–º –Ω—É–∂–Ω—ã –Ω–µ –ø–æ—É—á–µ–Ω–∏—è, –∞ –ø—Ä–∏–º–µ—Ä—ã",
        "4. –ù–∞—É—á–∏ —Å—ã–Ω–∞ –ø–æ—Å–ª—É—à–∞–Ω–∏—é, —Ç–æ–≥–¥–∞ —Å–º–æ–∂–µ—à—å –Ω–∞—É—á–∏—Ç—å –∏ –≤—Å–µ–º—É –æ—Å—Ç–∞–ª—å–Ω–æ–º—É"
    ], "styles": [4, 3, 2, 1]},

    {"q": "–†–µ–±–µ–Ω–æ–∫ –ø–æ–ª—É—á–∏–ª –¥–≤–æ–π–∫—É. –í–∞—à–∞ —Ä–µ–∞–∫—Ü–∏—è?", "a": [
        "1. –û–ø—è—Ç—å –¥–≤–æ–π–∫–∞? –î–∞ —Å–∫–æ–ª—å–∫–æ –º–æ–∂–Ω–æ. –í –∫–æ–≥–æ —Ç—ã —Ç–∞–∫–æ–π?",
        "2. –û–π, —è –≤ —Ç–≤–æ–µ –≤—Ä–µ–º—è —Å—Ç–æ–ª—å–∫–æ –¥–≤–æ–µ–∫ –ø–æ–ª—É—á–∞–ª(–∞), –Ω–∏—á–µ–≥–æ, —ç—Ç–æ –Ω–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å.",
        "3. –¢—ã —á—Ç–æ –ø–æ–∑–æ—Ä–∏—à—å-—Ç–æ –Ω–∞—Å? –ö–∞–∫ —è –ª—é–¥—è–º –≤ –≥–ª–∞–∑–∞ —Å–º–æ—Ç—Ä–µ—Ç—å –±—É–¥—É?",
        "4. –ö–∞–∫ —Ç–∞–∫ –ø–æ–ª—É—á–∏–ª–æ—Å—å, —Ä–∞—Å—Å–∫–∞–∂–∏. –¢—ã –Ω–µ –ø–æ–Ω—è–ª(–∞) —Ç–µ–º—É? –ó–Ω–∞–µ—à—å, –∫–∞–∫ –º–æ–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å?"
    ], "styles": [1, 3, 4, 2]},

    {"q": "–†–µ–±–µ–Ω–æ–∫ –ø—Ä–æ—Å–∏—Ç –Ω–æ–≤—É—é –∏–≥—Ä—É—à–∫—É –≤ –º–∞–≥–∞–∑–∏–Ω–µ. –í—ã:", "a": [
        "1. –ê —Ç—ã —Å–ø—Ä–æ—Å–∏–ª —É –º–∞–º—ã/–ø–∞–ø—ã, –µ—Å—Ç—å –ª–∏ —É –Ω–∞—Å –¥–µ–Ω—å–≥–∏ –Ω–∞ —ç—Ç—É –∏–≥—Ä—É—à–∫—É?",
        "2. –£ —Ç–µ–±—è —ç—Ç–∏—Ö –∏–≥—Ä—É—à–µ–∫ –∏ —Ç–∞–∫ —Ü–µ–ª—ã–π —è—â–∏–∫, –ø—Ä–æ—Å—Ç–æ –≤–∞–ª—è—é—Ç—Å—è. –í–æ—Ç –≤ –Ω–∏—Ö –∏ –∏–≥—Ä–∞–π.",
        "3. –ö–∏–¥–∞–π –≤ –∫–æ—Ä–∑–∏–Ω—É, —á—Ç–æ —Ö–æ—á–µ—à—å.",
        "4. –î–∞–≤–∞–π –∑–∞–ø–∏—à–µ–º –µ–µ –≤ —Å–ø–∏—Å–æ–∫ –∂–µ–ª–∞–Ω–∏–π –∏ –∫—É–ø–∏–º –≤ –∫–æ–Ω—Ü–µ –Ω–µ–¥–µ–ª–∏, –µ—Å–ª–∏ –≤—Å–µ –Ω–∞—à–∏ –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã. –•–æ—Ä–æ—à–æ?"
    ], "styles": [1, 4, 3, 2]},

    {"q": "–†–µ–±–µ–Ω–æ–∫ –≥–æ–≤–æ—Ä–∏—Ç '–Ø —Å–∞–º!', –Ω–æ —É –Ω–µ–≥–æ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è. –í—ã:", "a": [
        "1. –Ø –≤–∏–∂—É, —á—Ç–æ —Ç—ã —Ö–æ—á–µ—à—å —Å–¥–µ–ª–∞—Ç—å –≤—Å–µ —Å–∞–º. –•–æ—Ä–æ—à–æ. –ï—Å–ª–∏ —Ç–µ–±–µ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –ø–æ–º–æ—â—å, –ø–æ–∑–æ–≤–∏ –º–µ–Ω—è, —è —Ä—è–¥–æ–º.",
        "2. –ú—ã –∏–∑-–∑–∞ —Ç–µ–±—è –æ–ø–æ–∑–¥–∞–µ–º. –°–∞–º –æ–Ω! –î–∞–≤–∞–π —É–∂–µ, —à–µ–≤–µ–ª–∏—Å—å.",
        "3. –£ —Ç–µ–±—è –∂–µ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è, —Ç—ã –Ω–µ –≤–∏–¥–∏—à—å? –î–∞–≤–∞–π —è –ø–æ–∫–∞–∂—É, –∫–∞–∫ –Ω–∞–¥–æ.",
        "4. –ö–∞–∫ –∑–∞–∫–æ–Ω—á–∏—à—å ‚Äì –ø–æ–∑–æ–≤–∏ –º–µ–Ω—è."
    ], "styles": [2, 4, 1, 3]},

    {"q": "–†–µ–±–µ–Ω–æ–∫ –ø–ª–∞—á–µ—Ç –∏–∑-–∑–∞ —Å—Å–æ—Ä—ã —Å –¥—Ä—É–≥–æ–º. –í—ã:", "a": [
        "1. –ù–µ –ø–ª–∞—á—å, –ø–æ–º–∏—Ä–∏—Ç–µ—Å—å –µ—â—ë. –≠—Ç–æ –Ω–µ –ø–æ–≤–æ–¥ –¥–ª—è —Å–ª–µ–∑.",
        "2. –¢–µ–±–µ –≥—Ä—É—Å—Ç–Ω–æ, –≤—ã –ø–æ—Ä—É–≥–∞–ª–∏—Å—å —Å –¥—Ä—É–≥–æ–º. –¢–µ–±—è –æ–±–Ω—è—Ç—å?",
        "3. –ö–∞–∫–∞—è –Ω–µ–ø—Ä–∏—è—Ç–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è. –í—Å–µ –Ω–∞–ª–∞–¥–∏—Ç—Å—è. –í–æ—Ç —É–≤–∏–¥–∏—à—å, –∑–∞–≤—Ç—Ä–∞ –ø–æ–º–∏—Ä–∏—Ç–µ—Å—å.",
        "4. –¢–æ–∂–µ –º–Ω–µ, –ø—Ä–∏–¥—É–º–∞–ª(–∞), –∏–∑-–∑–∞ —á–µ–≥–æ –ø–ª–∞–∫–∞—Ç—å. –£—Å–ø–æ–∫–æ–π—Å—è."
    ], "styles": [1, 2, 3, 4]},

    {"q": "–ö–∞–∫ –≤—ã –ø–æ—Å—Ç—É–ø–∏—Ç–µ, –µ—Å–ª–∏ —É–∑–Ω–∞–µ—Ç–µ, —á—Ç–æ –≤–∞—à–µ–≥–æ —Ä–µ–±–µ–Ω–∫–∞ –æ–±–∏–¥–µ–ª –æ–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫?", "a": [
        "1. –û–≥–æ—Ä—á—É—Å—å, –ø–æ—Å—Ç–∞—Ä–∞—é—Å—å —É—Ç–µ—à–∏—Ç—å —Ä–µ–±–µ–Ω–∫–∞.",
        "2. –û—Ç–ø—Ä–∞–≤–ª—é—Å—å –≤—ã—è—Å–Ω–∏—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å —Ä–æ–¥–∏—Ç–µ–ª—è–º–∏ –æ–±–∏–¥—á–∏–∫–∞.",
        "3. –î–µ—Ç–∏ —Å–∞–º–∏ –ª—É—á—à–µ —Ä–∞–∑–±–µ—Ä—É—Ç—Å—è –≤ —Å–≤–æ–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö, —Ç–µ–º –±–æ–ª–µ–µ —á—Ç–æ –∏—Ö –æ–±–∏–¥—ã –Ω–µ–¥–æ–ª–≥–∏.",
        "4. –ü–æ—Å–æ–≤–µ—Ç—É—é —Ä–µ–±–µ–Ω–∫—É, –∫–∞–∫ –µ–º—É –ª—É—á—à–µ —Å–µ–±—è –≤–µ—Å—Ç–∏ –≤ —Ç–∞–∫–∏—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö."
    ], "styles": [3, 1, 4, 2]},

    {"q": "–ö–∞–∫ –≤—ã –æ—Ç—Ä–µ–∞–≥–∏—Ä—É–µ—Ç–µ, –µ—Å–ª–∏ —É–∑–Ω–∞–µ—Ç–µ, —á—Ç–æ —Ä–µ–±–µ–Ω–æ–∫ –≤–∞–º —Å–æ–ª–≥–∞–ª?", "a": [
        "1. –ü–æ—Å—Ç–∞—Ä–∞—é—Å—å –≤—ã–≤–µ—Å—Ç–∏ –µ–≥–æ –Ω–∞ —á–∏—Å—Ç—É—é –≤–æ–¥—É –∏ –ø—Ä–∏—Å—Ç—ã–¥–∏—Ç—å.",
        "2. –ï—Å–ª–∏ –ø–æ–≤–æ–¥ –Ω–µ —Å–ª–∏—à–∫–æ–º —Å–µ—Ä—å–µ–∑–Ω—ã–π, –Ω–µ —Å—Ç–∞–Ω—É –ø—Ä–∏–¥–∞–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è.",
        "3. –†–∞—Å—Å—Ç—Ä–æ—é—Å—å, –Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ —Å–∫–∞–∂—É.",
        "4. –ü–æ–ø—Ä–æ–±—É—é —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è, —á—Ç–æ –µ–≥–æ –ø–æ–±—É–¥–∏–ª–æ —Å–æ–ª–≥–∞—Ç—å."
    ], "styles": [1, 4, 3, 2]},

    {"q": "–°—á–∏—Ç–∞–µ—Ç–µ –ª–∏ –≤—ã, —á—Ç–æ –ø–æ–¥–∞–µ—Ç–µ —Ä–µ–±–µ–Ω–∫—É –¥–æ—Å—Ç–æ–π–Ω—ã–π –ø—Ä–∏–º–µ—Ä?", "a": [
        "1. –ë–µ–∑—É—Å–ª–æ–≤–Ω–æ.",
        "2. –°—Ç–∞—Ä–∞—é—Å—å.",
        "3. –ù–∞–¥–µ—é—Å—å.",
        "4. –ù–µ –∑–Ω–∞—é."
    ], "styles": [1, 2, 3, 4]},

    {"q": "–°–ª–µ–¥—É–µ—Ç –ª–∏ —Ä–æ–¥–∏—Ç–µ–ª—è–º –¥–∞–≤–∞—Ç—å —Ä–µ–±–µ–Ω–∫—É –¥–µ–Ω—å–≥–∏ –Ω–∞ –∫–∞—Ä–º–∞–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã?", "a": [
        "1. –ï—Å–ª–∏ –ø–æ–ø—Ä–æ—Å–∏—Ç, –º–æ–∂–Ω–æ –∏ –¥–∞—Ç—å.",
        "2. –õ—É—á—à–µ –≤—Å–µ–≥–æ —Ä–µ–≥—É–ª—è—Ä–Ω–æ –≤—ã–¥–∞–≤–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é —Å—É–º–º—É –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–µ–ª–∏ –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å—Ö–æ–¥—ã.",
        "3. –¶–µ–ª–µ—Å–æ–æ–±—Ä–∞–∑–Ω–æ –≤—ã–¥–∞–≤–∞—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—É—é —Å—É–º–º—É –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Å—Ä–æ–∫ (–Ω–∞ –Ω–µ–¥–µ–ª—é, –Ω–∞ –º–µ—Å—è—Ü), —á—Ç–æ–±—ã —Ä–µ–±–µ–Ω–æ–∫ —Å–∞–º —É—á–∏–ª—Å—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–∏ —Ä–∞—Å—Ö–æ–¥—ã.",
        "4. –ö–æ–≥–¥–∞ –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å, –º–æ–∂–Ω–æ –∏–Ω–æ–π —Ä–∞–∑ –¥–∞—Ç—å –µ–º—É –∫–∞–∫—É—é-—Ç–æ —Å—É–º–º—É."
    ], "styles": [3, 1, 2, 4]},

    {"q": "–ö–∞–∫ –≤—ã –æ—Ç–Ω–µ—Å–µ—Ç–µ—Å—å –∫ —Å–∫–≤–µ—Ä–Ω–æ—Å–ª–æ–≤–∏—é —Ä–µ–±–µ–Ω–∫–∞?", "a": [
        "1. –ü–æ—Å—Ç–∞—Ä–∞—é—Å—å –¥–æ–≤–µ—Å—Ç–∏ –¥–æ –µ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è, —á—Ç–æ –≤ –Ω–∞—à–µ–π —Å–µ–º—å–µ, –¥–∞ –∏ –≤–æ–æ–±—â–µ —Å—Ä–µ–¥–∏ –ø–æ—Ä—è–¥–æ—á–Ω—ã—Ö –ª—é–¥–µ–π —ç—Ç–æ –Ω–µ –ø—Ä–∏–Ω—è—Ç–æ.",
        "2. –°–∫–≤–µ—Ä–Ω–æ—Å–ª–æ–≤–∏–µ –Ω–∞–¥–æ –ø—Ä–µ—Å–µ–∫–∞—Ç—å –≤ –∑–∞—Ä–æ–¥—ã—à–µ! –ù–∞–∫–∞–∑–∞–Ω–∏–µ —Ç—É—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, –∞ –æ—Ç –æ–±—â–µ–Ω–∏—è —Å –Ω–µ–≤–æ—Å–ø–∏—Ç–∞–Ω–Ω—ã–º–∏ —Å–≤–µ—Ä—Å—Ç–Ω–∏–∫–∞–º–∏ —Ä–µ–±–µ–Ω–∫–∞ –≤–ø—Ä–µ–¥—å –Ω–∞–¥–æ –æ–≥—Ä–∞–¥–∏—Ç—å.",
        "3. –ü–æ–¥—É–º–∞–µ—à—å! –í—Å–µ –º—ã –∑–Ω–∞–µ–º —ç—Ç–∏ —Å–ª–æ–≤–∞. –ù–µ –Ω–∞–¥–æ –ø—Ä–∏–¥–∞–≤–∞—Ç—å —ç—Ç–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—è, –ø–æ–∫–∞ —ç—Ç–æ –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ —Ä–∞–∑—É–º–Ω—ã–µ –ø—Ä–µ–¥–µ–ª—ã.",
        "4. –†–µ–±–µ–Ω–æ–∫ –≤–ø—Ä–∞–≤–µ –≤—ã—Ä–∞–∂–∞—Ç—å —Å–≤–æ–∏ —á—É–≤—Å—Ç–≤–∞ –¥–∞–∂–µ —Ç–µ–º —Å–ø–æ—Å–æ–±–æ–º, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–º –Ω–µ –ø–æ –¥—É—à–µ."
    ], "styles": [2, 1, 4, 3]}
]

# –ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤ (–±—É–¥–µ–º —Å—á–∏—Ç–∞—Ç—å —Å—Ç–∏–ª–∏)
answer_map = {
    1: "–ê–≤—Ç–æ—Ä–∏—Ç–∞—Ä–Ω—ã–π",
    2: "–ê–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π",
    3: "–õ–∏–±–µ—Ä–∞–ª—å–Ω—ã–π",
    4: "–ò–Ω–¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ç–Ω—ã–π"
}


user_data = {}

def check_subscription(update, context):
    user_id = update.effective_user.id
    channel_username = "@You_are_a_good_mom"
    try:
        member = context.bot.get_chat_member(chat_id=channel_username, user_id=user_id)
        if member.status not in ['member', 'administrator', 'creator']:
            raise Exception("Not subscribed")
    except:
        from telegram import InlineKeyboardMarkup, InlineKeyboardButton
        keyboard = InlineKeyboardMarkup([
            [InlineKeyboardButton("üì¢ –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª", url=f"https://t.me/{channel_username.strip('@')}")]
        ])
        update.message.reply_text(
            "üòî –î–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞ –ø–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –Ω–∞—à –∫–∞–Ω–∞–ª –∏ –≤–µ—Ä–Ω–∏—Ç–µ—Å—å —Å—é–¥–∞.",
            reply_markup=keyboard
        )
        return False
    return True

def start(update: Update, context: CallbackContext):
    args = context.args
    if not check_subscription(update, context):
        return
    if args and args[0] == "start_test":
        return start_test(update, context)
    keyboard = ReplyKeyboardMarkup(
        [['üöÄ –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç']],
        resize_keyboard=True,
        one_time_keyboard=True
    )
    name = update.effective_user.first_name
    update.message.reply_text(
        f"–ü—Ä–∏–≤–µ—Ç, {name}!\n"
        "–•–æ—Ç–∏—Ç–µ —É–∑–Ω–∞—Ç—å, –∫–∞–∫–æ–π —É –≤–∞—Å —Å—Ç–∏–ª—å –≤–æ—Å–ø–∏—Ç–∞–Ω–∏—è –∏ –∫–∞–∫ –æ–Ω –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–µ–±–µ–Ω–∫–∞?\n\n"
        "–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –ø—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç (10 –≤–æ–ø—Ä–æ—Å–æ–≤):",
        reply_markup=keyboard
    )

def start_test(update: Update, context: CallbackContext):
    if not check_subscription(update, context):
        return
    user_id = update.message.from_user.id
    user_data[user_id] = {
        "current_q": 0,
        "answers": []
    }
    send_question(update, context)

def send_question(update: Update, context: CallbackContext):
    user_id = update.message.from_user.id
    data = user_data[user_id]
    q_num = data["current_q"]
    if q_num < len(questions):
        q_data = questions[q_num]
        keyboard = [[a] for a in q_data["a"]]
        reply_markup = ReplyKeyboardMarkup(keyboard, one_time_keyboard=True, resize_keyboard=True)
        update.message.reply_text(f"–í–æ–ø—Ä–æ—Å {q_num + 1}:\n{q_data['q']}", reply_markup=reply_markup)
    else:
        show_result(update, context)

def handle_answer(update: Update, context: CallbackContext):
    if update.message.text == "üöÄ –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç":
        return start_test(update, context)
    user_id = update.message.from_user.id
    text = update.message.text
    data = user_data.get(user_id)
    if not data:
        update.message.reply_text("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—á–Ω–∏—Ç–µ —Å /start_test")
        return
    q_num = data["current_q"]
    q_data = questions[q_num]
    for i in range(4):
        if text.startswith(str(i + 1)):
            data["answers"].append(q_data["styles"][i])
            break
    else:
        update.message.reply_text("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤.")
        return
    data["current_q"] += 1
    send_question(update, context)


def show_result(update: Update, context: CallbackContext):
    from telegram import InlineKeyboardMarkup, InlineKeyboardButton
    user_id = update.message.from_user.id
    answers = user_data[user_id]["answers"]
    style_count = {"–ê–≤—Ç–æ—Ä–∏—Ç–∞—Ä–Ω—ã–π": 0, "–ê–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π": 0, "–õ–∏–±–µ—Ä–∞–ª—å–Ω—ã–π": 0, "–ò–Ω–¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ç–Ω—ã–π": 0}
    for a in answers:
        style_count[answer_map[a]] += 1
    style = max(style_count, key=style_count.get)
    result_texts = {
        "–ê–≤—Ç–æ—Ä–∏—Ç–∞—Ä–Ω—ã–π": """üîπ *–£ –≤–∞—Å –ø—Ä–µ–æ–±–ª–∞–¥–∞–µ—Ç –ê–≤—Ç–æ—Ä–∏—Ç–∞—Ä–Ω—ã–π —Å—Ç–∏–ª—å:*
¬´–ö–∞–∂–µ—Ç—Å—è, –≤—ã –ø—Ä–∏–≤—ã–∫–ª–∏ –∫ —Å—Ç—Ä–æ–≥–∏–º –ø—Ä–∞–≤–∏–ª–∞–º‚Ä¶¬ª

–í—ã —á—ë—Ç–∫–æ –∑–Ω–∞–µ—Ç–µ, ¬´–∫–∞–∫ –Ω–∞–¥–æ¬ª, –∏ —Ç—Ä–µ–±—É–µ—Ç–µ —ç—Ç–æ–≥–æ –æ—Ç —Ä–µ–±—ë–Ω–∫–∞. –ù–æ –∏–Ω–æ–≥–¥–∞ –µ–º—É –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç —Ç–µ–ø–ª–∞ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤—ã—Å–∫–∞–∑–∞—Ç—å—Å—è.

*–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:*
‚úîÔ∏è –û–±—ä—è—Å–Ω–∏—Ç—å –æ–¥–∏–Ω –∑–∞–ø—Ä–µ—Ç: _¬´–Ø –Ω–µ —Ä–∞–∑—Ä–µ—à–∞—é —Ç–µ–±–µ –µ—Å—Ç—å –∫–æ–Ω—Ñ–µ—Ç—ã –ø–µ—Ä–µ–¥ –æ–±–µ–¥–æ–º, –ø–æ—Ç–æ–º—É —á—Ç–æ‚Ä¶¬ª_
‚úîÔ∏è –°–ø—Ä–æ—Å–∏—Ç—å: _¬´–ê –∫–∞–∫ —Ç—ã –¥—É–º–∞–µ—à—å?¬ª_

_–•–æ—á–µ—Ç—Å—è –ª—É—á—à–µ –ø–æ–Ω—è—Ç—å —Å–µ–±—è –∏ —Å–≤–æ–µ–≥–æ —Ä–µ–±–µ–Ω–∫–∞?
–û–Ω–ª–∞–π–Ω-–∏–Ω—Ç–µ–Ω—Å–∏–≤ ¬´–£–∑–Ω–∞–π —Å–µ–±—è ‚Äî —É–∑–Ω–∞–π —Å–≤–æ–µ–≥–æ —Ä–µ–±–µ–Ω–∫–∞¬ª –ø–æ–º–æ–∂–µ—Ç –≤–∑–≥–ª—è–Ω—É—Ç—å –Ω–∞ –≤–æ—Å–ø–∏—Ç–∞–Ω–∏–µ –ø–æ-–Ω–æ–≤–æ–º—É.

üîπ –ü—Ä–æ—Ö–æ–¥–∏—Ç–µ –≤ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –∏ —Ç–µ–º–ø–µ ‚Äî –∑–∞ –¥–µ–Ω—å –∏–ª–∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ.
üîπ –ë–µ–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π, –≤—Å—Ç—Ä–µ—á –∏ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤.
üîπ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞—Ä—ã —Å–ø–æ–∫–æ–π–Ω—ã—Ö –º–∏–Ω—É—Ç –≤ –¥–µ–Ω—å.

üëâ –£–∑–Ω–∞–π—Ç–µ, —á—Ç–æ –≤–∞—Å –∂–¥–µ—Ç, –∫–æ–º—É –ø–æ–¥—Ö–æ–¥–∏—Ç –∏ –∫–∞–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–∞—Å—Ç ‚Äî –ø–æ –∫–Ω–æ–ø–∫–µ –Ω–∏–∂–µ:_""",
        "–ê–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π": """üîπ *–£ –≤–∞—Å –ø—Ä–µ–æ–±–ª–∞–¥–∞–µ—Ç –ê–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π —Å—Ç–∏–ª—å:*
¬´–í—ã ‚Äî –º–∞—Å—Ç–µ—Ä –±–∞–ª–∞–Ω—Å–∞!¬ª

–í—ã —É–º–µ–µ—Ç–µ –∏ –ª—é–±–∏—Ç—å, –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –≥—Ä–∞–Ω–∏—Ü—ã. –†–µ–±—ë–Ω–æ–∫ —Ä–∞—Å—Ç—ë—Ç –≤ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏, —á—Ç–æ –µ–≥–æ —Å–ª—ã—à–∞—Ç.

*–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!*
‚úîÔ∏è –î–∞–≤–∞–π—Ç–µ –±–æ–ª—å—à–µ –≤—ã–±–æ—Ä–∞: _¬´–ö–∞–∫—É—é —à–∞–ø–∫—É –Ω–∞–¥–µ–Ω–µ–º?¬ª_
‚úîÔ∏è –•–≤–∞–ª–∏—Ç–µ –∑–∞ —É—Å–∏–ª–∏—è, –Ω–µ —Ç–æ–ª—å–∫–æ –∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

_–•–æ—á–µ—Ç—Å—è –ª—É—á—à–µ –ø–æ–Ω—è—Ç—å —Å–µ–±—è –∏ —Å–≤–æ–µ–≥–æ —Ä–µ–±–µ–Ω–∫–∞?
–û–Ω–ª–∞–π–Ω-–∏–Ω—Ç–µ–Ω—Å–∏–≤ ¬´–£–∑–Ω–∞–π —Å–µ–±—è ‚Äî —É–∑–Ω–∞–π —Å–≤–æ–µ–≥–æ —Ä–µ–±–µ–Ω–∫–∞¬ª –ø–æ–º–æ–∂–µ—Ç –≤–∑–≥–ª—è–Ω—É—Ç—å –Ω–∞ –≤–æ—Å–ø–∏—Ç–∞–Ω–∏–µ –ø–æ-–Ω–æ–≤–æ–º—É.

üîπ –ü—Ä–æ—Ö–æ–¥–∏—Ç–µ –≤ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –∏ —Ç–µ–º–ø–µ ‚Äî –∑–∞ –¥–µ–Ω—å –∏–ª–∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ.
üîπ –ë–µ–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π, –≤—Å—Ç—Ä–µ—á –∏ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤.
üîπ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞—Ä—ã —Å–ø–æ–∫–æ–π–Ω—ã—Ö –º–∏–Ω—É—Ç –≤ –¥–µ–Ω—å.

üëâ –£–∑–Ω–∞–π—Ç–µ, —á—Ç–æ –≤–∞—Å –∂–¥–µ—Ç, –∫–æ–º—É –ø–æ–¥—Ö–æ–¥–∏—Ç –∏ –∫–∞–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–∞—Å—Ç ‚Äî –ø–æ –∫–Ω–æ–ø–∫–µ –Ω–∏–∂–µ:_""",
        "–õ–∏–±–µ—Ä–∞–ª—å–Ω—ã–π": """üîπ *–£ –≤–∞—Å –ø—Ä–µ–æ–±–ª–∞–¥–∞–µ—Ç –õ–∏–±–µ—Ä–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å:*
¬´–í—ã ‚Äî –¥—Ä—É–≥ —Å–≤–æ–µ–º—É —Ä–µ–±—ë–Ω–∫—É‚Ä¶¬ª

–í—ã –∏–∑–±–µ–≥–∞–µ—Ç–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏ –¥–∞—ë—Ç–µ –º–Ω–æ–≥–æ —Å–≤–æ–±–æ–¥—ã. –ù–æ –¥–µ—Ç—è–º –≤–∞–∂–Ω—ã –∏ –ø—Ä–∞–≤–∞, –∏ —á—ë—Ç–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞.

*–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:*
‚úîÔ∏è –í–≤–µ–¥–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–æ: _¬´–ß–∏—Å—Ç–∏–º –∑—É–±—ã –ø–µ—Ä–µ–¥ —Å–Ω–æ–º¬ª_
‚úîÔ∏è –£—á–∏—Ç–µ—Å—å –≥–æ–≤–æ—Ä–∏—Ç—å ¬´–Ω–µ—Ç¬ª –∏ –æ–±—ä—è—Å–Ω—è—Ç—å –ø–æ—á–µ–º—É.

_–•–æ—á–µ—Ç—Å—è –ª—É—á—à–µ –ø–æ–Ω—è—Ç—å —Å–µ–±—è –∏ —Å–≤–æ–µ–≥–æ —Ä–µ–±–µ–Ω–∫–∞?
–û–Ω–ª–∞–π–Ω-–∏–Ω—Ç–µ–Ω—Å–∏–≤ ¬´–£–∑–Ω–∞–π —Å–µ–±—è ‚Äî —É–∑–Ω–∞–π —Å–≤–æ–µ–≥–æ —Ä–µ–±–µ–Ω–∫–∞¬ª –ø–æ–º–æ–∂–µ—Ç –≤–∑–≥–ª—è–Ω—É—Ç—å –Ω–∞ –≤–æ—Å–ø–∏—Ç–∞–Ω–∏–µ –ø–æ-–Ω–æ–≤–æ–º—É.

üîπ –ü—Ä–æ—Ö–æ–¥–∏—Ç–µ –≤ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –∏ —Ç–µ–º–ø–µ ‚Äî –∑–∞ –¥–µ–Ω—å –∏–ª–∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ.
üîπ –ë–µ–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π, –≤—Å—Ç—Ä–µ—á –∏ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤.
üîπ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞—Ä—ã —Å–ø–æ–∫–æ–π–Ω—ã—Ö –º–∏–Ω—É—Ç –≤ –¥–µ–Ω—å.

üëâ –£–∑–Ω–∞–π—Ç–µ, —á—Ç–æ –≤–∞—Å –∂–¥–µ—Ç, –∫–æ–º—É –ø–æ–¥—Ö–æ–¥–∏—Ç –∏ –∫–∞–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–∞—Å—Ç ‚Äî –ø–æ –∫–Ω–æ–ø–∫–µ –Ω–∏–∂–µ:_""",
        "–ò–Ω–¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ç–Ω—ã–π": """üîπ *–£ –≤–∞—Å –ø—Ä–µ–æ–±–ª–∞–¥–∞–µ—Ç –ò–Ω–¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ç–Ω—ã–π —Å—Ç–∏–ª—å:*
¬´–í—ã —Ä–µ–¥–∫–æ –≤–º–µ—à–∏–≤–∞–µ—Ç–µ—Å—å –≤ –∂–∏–∑–Ω—å —Ä–µ–±—ë–Ω–∫–∞‚Ä¶¬ª

–í–æ–∑–º–æ–∂–Ω–æ, –≤—ã —É—Å—Ç–∞–ª–∏ –∏–ª–∏ –Ω–µ –∑–Ω–∞–µ—Ç–µ, –∫–∞–∫ –≤–∫–ª—é—á–∏—Ç—å—Å—è. –ù–æ —Ä–µ–±—ë–Ω–∫—É –≤–∞–∂–Ω–æ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É.

*–ù–∞—á–Ω–∏—Ç–µ —Å –º–∞–ª–æ–≥–æ:*
‚úîÔ∏è –ü—Ä–æ–≤–æ–¥–∏—Ç–µ 10 –º–∏–Ω—É—Ç –±–µ–∑ –≥–∞–¥–∂–µ—Ç–æ–≤
‚úîÔ∏è –°–ø—Ä–æ—Å–∏—Ç–µ: _¬´–ö–∞–∫ –ø—Ä–æ—à—ë–ª —Ç–≤–æ–π –¥–µ–Ω—å?¬ª_

_–•–æ—á–µ—Ç—Å—è –ª—É—á—à–µ –ø–æ–Ω—è—Ç—å —Å–µ–±—è –∏ —Å–≤–æ–µ–≥–æ —Ä–µ–±–µ–Ω–∫–∞?
–û–Ω–ª–∞–π–Ω-–∏–Ω—Ç–µ–Ω—Å–∏–≤ ¬´–£–∑–Ω–∞–π —Å–µ–±—è ‚Äî —É–∑–Ω–∞–π —Å–≤–æ–µ–≥–æ —Ä–µ–±–µ–Ω–∫–∞¬ª –ø–æ–º–æ–∂–µ—Ç –≤–∑–≥–ª—è–Ω—É—Ç—å –Ω–∞ –≤–æ—Å–ø–∏—Ç–∞–Ω–∏–µ –ø–æ-–Ω–æ–≤–æ–º—É.

üîπ –ü—Ä–æ—Ö–æ–¥–∏—Ç–µ –≤ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –∏ —Ç–µ–º–ø–µ ‚Äî –∑–∞ –¥–µ–Ω—å –∏–ª–∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ.
üîπ –ë–µ–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π, –≤—Å—Ç—Ä–µ—á –∏ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤.
üîπ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞—Ä—ã —Å–ø–æ–∫–æ–π–Ω—ã—Ö –º–∏–Ω—É—Ç –≤ –¥–µ–Ω—å.

üëâ –£–∑–Ω–∞–π—Ç–µ, —á—Ç–æ –≤–∞—Å –∂–¥–µ—Ç, –∫–æ–º—É –ø–æ–¥—Ö–æ–¥–∏—Ç –∏ –∫–∞–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–∞—Å—Ç ‚Äî –ø–æ –∫–Ω–æ–ø–∫–µ –Ω–∏–∂–µ:_"""
    }
    buttons = [
        [InlineKeyboardButton("üéØ –•–æ—á—É –Ω–∞ –∏–Ω—Ç–µ–Ω—Å–∏–≤", url="https://kids-psy.ru/intensive/relaunch")],
        [InlineKeyboardButton("üîÅ –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –µ—â—ë —Ä–∞–∑", url="https://t.me/ParentStyleBot?start=start_test")]
    ]
    update.message.reply_text(
        result_texts[style],
        parse_mode='Markdown',
        reply_markup=InlineKeyboardMarkup(buttons)
    )
    user_data.pop(user_id)

# --- Flask and polling
app = Flask(__name__)

@app.route('/ping', methods=['GET', 'HEAD'])
def ping():
    return 'pong', 200

def run_flask():
    app.run(host='0.0.0.0', port=8080)

def main():
    threading.Thread(target=run_flask).start()
    updater = Updater(TOKEN, use_context=True)
    dp = updater.dispatcher
    dp.add_handler(CommandHandler("start", start))
    dp.add_handler(CommandHandler("start_test", start_test))
    dp.add_handler(MessageHandler(Filters.text & ~Filters.command, handle_answer))
    updater.start_polling()
    print("Bot started. Listening...")
    updater.idle()

if __name__ == '__main__':
    main()